# RGB_Mixer

光の3原色を体感するために作成したデバイス。

* 赤青緑のスライダを動かしてさまざまな色を作ってみる
* デモモードでは自動的に色を変える

## ハードウェア

回路図は`RGB_Mixer_Schematic.pdf`にある。

* マイコン周りは3.3V、LEDは5V
    * LEDのVFが高めのため、LEDは5Vで駆動することにした
    * 電池の出力をそのままLEDに流すと、経時で電圧降下した際に明るさが変わる。
    変化の仕方は各色で異なるため、満充電で白色になるように調整しておいても、使用しているうちに色味がかかってしまう。
    それを避けるためにDCDCコンバータで定電圧(=定電流)になるようにした
    * Q1,2,3周りは異電圧間のインターフェース回路
* 単三充電池2本で5〜6時間動作
    全点灯で300〜400mA流れるため、1500〜2000mAhの容量が必要になる。
    Li-Po電池ではかなり大容量の部類になることもあり、単三形の電池にした
* LED
    * パワーLEDを採用。砲弾型だと暗いため
    * PWM制御
    3色のVfがそれぞれ異なる。ボリュームの出力をそのままLEDに接続すると、ボリューム位置と強度の関係が色ごとに異なってしまう。  
    PWMであれば3色とも同じように変化させることができる
* RV4〜6はBカーブ品にしたが、人間の視覚が明るさに対して線形ではなく対数的に変化するため、Aカーブがよいかもしれない。  
現在はファームウェア内で対数処理をしている
* R1〜3は最大の明るさを決める。なくても動作するが、半固定抵抗調整中に誤って大電流を流す事故を避けるために入れてある
* マイコンの`Batt`、`Slide_R`、`Slide_G`、`Slide_B`入力前にローパスフィルタを入れたが、あまり効果がない模様。  
定数を見直すかファームウェアで移動平均を取るなどして、フィルタはなしにしてもよいかもしれない
* ファームウェアにCircuitPythonを使っており、マイコンはCircuitPythonが使用できるボードなら他のものでも可。  
[CircuitPythonのサイト](https://circuitpython.org/downloads)にリストがある。
* LEDカバーは半透明のものであればよく、紙コップでも可。  
スモーキング加工した樹脂でもよいかもしれない

### 使用部品

実際に作成したものについては以下の通り。

抵抗や積層セラミックコンデンサは特定の型番である必要はない。秋月電子や千石電商、マルツで入手できる。

| リファレンス | 名称 | 型番 | 購入先 | 備考 |
|---|---|---|---|---|---|
| U1 | DCDCコンバータ | AE-XCL103-5V0 | 秋月電子 | |
| D1 | 3色LED | OSTCXBEAC1S | 秋月電子 | |
| RV4, 5, 6 | スライドボリューム | RS45111-OC10-CO-PO-B103 | 千石電商 | |
| R1〜7 | 抵抗 | |  | | 1/4W品 |
| RV1, 2, 3 | 半固定抵抗 | 3362P 100Ω | 秋月電子 | |
| M1 | マイコンボード | Seeed Xiao RP2040 | 秋月電子など | |
| SW1(D2) | 電源スイッチ | DS-060K-S-LG | 千石電商など | D2はスイッチ内蔵のLED |
| SW2 | モード切替スイッチ | JF-15CKCGNP2 | マルツ | モーメンタリなら可 |
| Q1, 2, 3 | トランジスタ | 2SC2120 | 秋月電子 | |
| C1〜4 | 抵抗 | 積層セラミックコンデンサ | | |
| | ケース | PF20-4-13W | マルツ | |
| | 電池ボックス | BC3-2L-W | マルツ | |
| | スライドボリュームつまみ | fader-mk2-red | 千石電商 | blueとgreenも |
| | LEDカバー | ポンポンライト | ダイソー | その他の形状もあり |

URLは以下。

* AE-XCL103-5V0: https://akizukidenshi.com/catalog/g/gK-15097/
* OSTCXBEAC1S: https://akizukidenshi.com/catalog/g/gI-13755/
* RS45111-OC10-CO-PO-B103: https://www.sengoku.co.jp/mod/sgk_cart/detail.php?code=EEHD-4HS6
* 3362P 100Ω: https://akizukidenshi.com/catalog/g/gP-03267/
* Seeed Xiao RP2040: https://akizukidenshi.com/catalog/g/gM-17044/
* DS-060K-S-LG:  https://www.sengoku.co.jp/mod/sgk_cart/detail.php?code=EEHD-5CHE
* JF-15CKCGNP2: https://www.marutsu.co.jp/GoodsDetail.jsp?q=JF-15CKCGNP2&salesGoodsCode=15724&shopNo=3
* 2SC2120: https://akizukidenshi.com/catalog/g/gI-13829/
* PF20-4-13W:  https://www.marutsu.co.jp/pc/i/515753/
* BC3-2L-W: https://www.marutsu.co.jp/pc/i/2236794/
* fader-mk2-red: https://www.sengoku.co.jp/mod/sgk_cart/detail.php?code=EEHD-5KM5
* ポンポンライト: https://jp.daisonet.com/products/4549131971408?_pos=2&_sid=26a631bf3&_ss=r

### 組立と調整

* 回路を組んだらケースに収納する前に明るさの調整をする
    1. 緑のボリューム(RV5)を最大にし、半固定抵抗(RV2)で明るさを調整する
    明るすぎると目を痛める恐れもあるのでほどほどに
    1. 赤のボリューム(RV6)を最大にし、黄色になるように半固定抵抗(RV3)を調整する
    1. 青のボリュームを最大にし、白色になるように半固定抵抗を調整する
    * 他の2色の組み合わせより、緑と赤のほうがやりやすいだろう
* ポンポンライトの底面にある基板は取り除いておく
* スライドボリュームとつまみは大きさが少し異なり、すぐに抜けてしまう。
ボリューム側の軸を削って少し薄くし、エポキシ接着剤で固定した。
それでも乱暴に扱われている間に抜ける。
* マイコンのUSBコネクタを出しておく方がファームウェアの書き換えはしやすい
* モード切替スイッチはパネル取り付けタイプではないため、足の位置に穴を空けてエポキシ接着剤で固定した
* ケースは3Dプリンタでもよいかも

## ファームウェア

(執筆予定)